{% extends "base.html" %}
{% block content %}
<style>
  .chat-container {
    max-width: 800px;
    margin: 2rem auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .tabs {
    display: flex;
    border-bottom: 2px solid #e0e0e0;
    margin-bottom: 1rem;
  }
  .tab {
    flex: 1;
    text-align: center;
    padding: 10px;
    cursor: pointer;
    font-weight: bold;
    color: #444;
  }
  .tab.active {
    color: #2b6e4f;
    border-bottom: 3px solid #2b6e4f;
  }
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }
  .chat-box {
    margin-bottom: 1rem;
    max-height: 400px;
    overflow-y: auto;
  }
  .message {
    margin: 8px 0;
    padding: 10px 14px;
    border-radius: 12px;
    max-width: 70%;
  }
  .user-msg {
    background: #e6f4ea;
    margin-left: auto;
    text-align: right;
  }
  .bot-msg {
    background: #f0f0f0;
    margin-right: auto;
    text-align: left;
  }

  /* Extra styles for bot replies */
  .bot-msg ul {
    margin: 6px 0 6px 18px;
    padding: 0;
  }
  .bot-msg p {
    margin: 6px 0;
  }
  .bot-msg b {
    display: block;
    margin-top: 6px;
    color: #333;
  }
  .bot-msg .warning {
    background: #fff3cd;
    padding: 6px 10px;
    border-radius: 6px;
    margin: 6px 0;
  }
  .bot-msg .precautions {
    background: #e7f5ee;
    padding: 6px 10px;
    border-radius: 6px;
    margin: 6px 0;
  }
  .input-row {
    display: flex;
    margin-top: 1rem;
  }
  .input-row input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  .input-row button {
    margin-left: 8px;
    padding: 10px 18px;
    border: none;
    background: #2b6e4f;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }
</style>

<div class="chat-container">
  <h3>{{ profile.name }}'s Health Assistant</h3>
  <p>Age: {{ profile.age or '—' }}, Gender: {{ profile.gender or '—' }}</p>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" data-tab="chat" onclick="switchTab('chat')">Chat Assistant</div>
    <div class="tab" data-tab="history" onclick="switchTab('history')">Chat History</div>
  </div>

  <!-- Chat Assistant -->
  <div id="chat" class="tab-content active">
    <div class="chat-box">
      {% for chat in chats %}
        <div class="message user-msg"><strong>You:</strong> {{ chat.message }}</div>
        <div class="message bot-msg"><strong>Bot:</strong> {{ chat.response|safe }}</div>
      {% endfor %}
    </div>

    <form method="POST" class="input-row">
      <input type="text" name="message" placeholder="Describe your symptoms or ask a health question..." required>
      <button type="submit">Send</button>
    </form>
  </div>

  <!-- Chat History -->
  <div id="history" class="tab-content">
    <h4>Previous Conversations</h4>
    <ul>
      {% for chat in chats %}
        <li><strong>You:</strong> {{ chat.message }}<br>
            <strong>Bot:</strong> {{ chat.response|safe }}</li>
      {% else %}
        <li>No chat history yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>

<script>
  function switchTab(tabId) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

    document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
    document.getElementById(tabId).classList.add('active');
  }
</script>

{% endblock %}
